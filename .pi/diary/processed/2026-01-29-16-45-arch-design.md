# Session Diary

**Date**: 2026-01-29 16:45
**Session ID**: 2026-01-29-16-45-arch-design
**Project**: /home/michael/work/ai/TOOLS/tmuxx

## Task Summary
Převedení a rozpracování úkolů z `TODO.md` do systému `dot` tasků. Cílem bylo v roli "Design Architekta" vytvořit precizní technické zadání pro budoucí autonomní implementaci, včetně analýzy kódu a architektonických rozhodnutí.

## Work Done
- Analyzována struktura projektu `tmuxx` (zejména `config.rs`, `state.rs`, `app.rs` a UI komponenty).
- Vytvořeno 5 detailních `dot` tasků s technickou specifikací (Global Highlights, Async TODO, Menu Vars, Tree Collapse, Focus Outside Tmux).
- Aktualizován `TODO.md` (ponechány pouze nápady/roadmapa).
- Aktualizován skill `dot-manager` (`/home/michael/.claude/skills/dot-manager/SKILL.md`) – přidána definice role "Design Architect" a nutnost hluboké analýzy před vytvořením tasku.
- Opraveny a doplněny tasky v `dots` o konkrétní úryvky kódu, cesty k souborům a architektonická rozhodnutí (použití `tokio::spawn`, defaultní wrappery).

## Design Decisions
- **Async TODO Generator**: Rozhodnuto použít `tokio::process::Command` a `tokio::spawn`, aby periodický refresh nezpůsoboval lagy v TUI.
- **Global Highlight Rules**: Odstranění hardcoded pravidel z kódu a jejich přesun do `defaults.toml` pro maximální konfigurovatelnost.
- **Action Menu Variables**: Využití stávajícího systému expanze proměnných (jako `{session}`) pro konzistenci.
- **Session Collapse**: Implementace pomocí nových variant `Action`, které umožňují mapování na klávesy `+`, `-`, `*` v konfiguraci.
- **Focus Outside Tmux**: Nastavení `xterm -e "{cmd}"` jako výchozího wrapperu.

## Challenges & Solutions
| Challenge | Solution |
|-----------|----------|
| Příliš stručné zadání v dots | Provedena analýza zdrojového kódu a re-populace tasků s konkrétními názvy polí a řádky. |
| Zákaz přímého přístupu k `.dots/` | Striktní přechod na používání pouze `dot` CLI pro veškeré operace s tasky. |

## Mistakes & Corrections

### Where I Made Errors:
- Zpočátku jsem vytvořil tasky příliš stručné, bez hlubší analýzy kódu, což odporuje roli architekta.
- Pokusil jsem se číst/psát do adresáře `.dots/` přímo, přestože uživatel preferuje výhradně CLI.

### What Caused the Mistakes:
- Podcenění role "Design Architekta" a sklouznutí k pouhému kopírování textu z `TODO.md` bez technického domyšlení detailů.

## Lessons Learned

### Technical Lessons:
- Role "Manager" v Dots Factory vyžaduje precizní technické rozhodování (např. async vs sync), aby "Worker" agenty nemuseli nic hádat.
- Je nutné vždy nejprve přečíst relevantní soubory (`read`), než se začne psát zadání tasku.

### Process Lessons:
- Kvalita výstupu workerů přímo závisí na kvalitě "Designu" v dot zadání.
- Skill `dot-manager` musí vynucovat roli architekta, ne jen zapisovatele.

### To Remember for CLAUDE.md:
- Uživatel preferuje nulovou hardcoded logiku v aplikaci (vše do `defaults.toml`).
- Uživatel striktně vyžaduje používání CLI nástrojů (`dot`) místo přímé manipulace s metadaty na disku.

## Skills Used

### Used in this session:
- [x] Skill: `/home/michael/.claude/skills/dot-manager/SKILL.md` - Aktualizován pro vynucení role Architekta.
- [x] Skill: `/home/michael/.claude/skills/dot-init/SKILL.md` - Použit pro kontrolu stavu dots.
- [x] Skill: `/home/michael/.pi/agent/skills/selflearn-diary/SKILL.md` - Záznam session.

### Feedback for Skills:

| File | Issue/Observation | Suggested Fix/Action |
|------|-------------------|----------------------|
| `/home/michael/.claude/skills/dot-manager/SKILL.md` | Původně příliš obecný, nekladl důraz na analýzu kódu. | Úspěšně aktualizován na roli Design Architekta. |

## User Preferences Observed

### Technical Preferences:
- Preferuje asynchronní řešení pro I/O operace v TUI.
- Odpor k hardcoded hodnotám; vše konfigurovatelné přes TOML.

### Process Preferences:
- Tasky v `dots` musí být detailní, technicky rozhodnuté a okamžitě vykonatelné.
- Striktní dodržování povolených rozhraní (CLI vs souborový systém).

## Code Patterns Used
- Konfigurační systém založený na `serde` a `defaults.toml`.
- Async loop v `ratatui` s neblokujícím refreshem dat.

## Notes
Session úspěšně transformovala backlog z vágního `TODO.md` do precizního technického plánu v `dots`.

# Session Diary

**Date**: 2026-01-23 11:11
**Session ID**: 767a7006-5458-43aa-bab4-152a2d618e97
**Project**: /home/michael/work/ai/TOOLS/tmuxcc

## Task Summary
Initialized development environment for tmuxcc project (fork of nyanko3141592/tmuxcc). Created comprehensive documentation (CLAUDE.md, IDEAS.md, TODO.md), migrated test scripts from tmuxclai-arch, researched and selected tui-textarea library for modal input editor. User dictated priorities from mobile (voice input with errors) which I decoded and organized into actionable tasks.

## Work Done
- Created CLAUDE.md with architecture overview, development workflow, testing guidelines
- Created TODO.md with 4 priority tasks (modal input, fix 'f' key, preview bug, statusline)
- Created IDEAS.md with long-term vision (hierarchical config, custom menu actions)
- Migrated and adapted 4 test scripts from tmuxclai-arch (cp-bin, reload-test, start-test, setup-multi-test)
- Researched and selected tui-textarea library for text editing
- Added Critical Development Rules section to CLAUDE.md (skill usage discipline)
- Committed all changes with proper git workflow

## Design Decisions

**1. Library selection for modal input: tui-textarea**
- **Why**: Actively maintained, supports ratatui 0.29, has popup example, feature-rich (undo/redo, selection, search)
- **Alternative considered**: Writing from scratch (rejected per user's "never write from scratch" rule)

**2. TODO priorities based on voice dictation**
- **Why**: User dictated 8 items via mobile, some were duplicates (3+4 = one issue, 6+7 = one issue)
- **Grouped into**: 4 concrete tasks (#1 modal input, #2 fix 'f' key, #3 preview bug, #4 statusline)

**3. Test scripts adapted from tmuxclai-arch**
- **Why**: Proven patterns from previous project, just needed name changes (tmuxclai ‚Üí tmuxcc)
- **Changes**: Updated binary names, session names, paths to match tmuxcc

**4. Documentation structure: CLAUDE.md vs IDEAS.md split**
- **Why**: CLAUDE.md = immediate development guidance, IDEAS.md = long-term vision
- **Benefit**: Clear separation between "how to work now" vs "where we're going"

## Challenges & Solutions

| Challenge | Solution |
|-----------|----------|
| tmuxcc not detecting Claude sessions initially | User discovered issue was stale tmux state - resolved after tmux restart |
| Decoding garbled voice dictation from mobile | Carefully analyzed patterns, asked user to confirm interpretation before acting |
| Finding right library for text editing | WebSearch ‚Üí rtfmbro MCP workflow to get current docs and examples |

## Mistakes & Corrections

### Where I Made Errors:
- **Used wrong skill name**: Tried `tmux-automation` instead of `tmux-automation:tmux-automation`
  - User correction: "kurva skill existuje pouzivas spatne jmeno" (harsh but clear feedback)
  - Fix: Immediately corrected and added Critical Development Rules to CLAUDE.md
- **Almost asked user to test my work**: Started testing workflow discussion
  - User reminded: "testing is implementer's responsibility - NEVER ask user to test"
  - Fix: Added this to CLAUDE.md principles

### What Caused the Mistakes:
- **Skill invocation**: Didn't check available skills list carefully, assumed short name
- **Testing habits**: Default assumption that user helps with testing - wrong for this user

## Lessons Learned

### Technical Lessons:
- **tui-textarea library**: Full-featured text editor for ratatui with popup support
- **rtfmbro MCP**: Excellent for getting library documentation (README, docs tree, specific files)
- **tmuxcc architecture**: Three-layer design (tmux ‚Üí parser ‚Üí app), AgentParser trait for extensibility
- **Process detection**: Multiple strategies (command, title, child processes, version pattern)

### Process Lessons:
- **Voice dictation handling**: When user dictates on mobile, expect garbled text - decode carefully and confirm
- **Library research first**: ALWAYS WebSearch ‚Üí rtfmbro ‚Üí examples before implementing
- **Skill discipline**: When user says "use skill X", MUST invoke it - if fails, STOP and ask
- **TODO organization**: Group related items (3+4 was one issue, 6+7 was one config feature)

### To Remember for CLAUDE.md:
- ‚úÖ Already added: Library Research Workflow section
- ‚úÖ Already added: Critical Development Rules (skill usage)
- User prefers: Direct action over proposals when explicitly requested
- User communicates in Czech when frustrated/correcting

## Skills & Commands Used

### Used in this session:
- [x] Command: `/init` - Create initial CLAUDE.md for project
- [x] Command: `/commit` (mentioned by user) - Git commit workflow
- [x] Skill: `tmux-automation:tmux-automation` (attempted, then corrected) - tmux session inspection
- [x] Command: `/mop-diary:diary` - Creating this diary entry

### Feedback for Skills/Commands:

| File | Issue/Observation | Suggested Fix/Action |
|------|-------------------|----------------------|
| User's CLAUDE.md | Skill invocation error not caught early | Pattern worked well - user's harsh feedback led to immediate CLAUDE.md update |
| `/init` command | Worked perfectly for scaffolding | None - good workflow |

## User Preferences Observed

### Git & PR Preferences:
- **Commit timing**: Only commit after completing logical chunks, must be functional state
- **Commit messages**: Use emoji prefixes (üìù docs, ‚ú® feat, üêõ fix, ‚ôªÔ∏è refactor, üíÑ style)
- **Co-authoring**: Always include "Co-Authored-By: Claude Sonnet 4.5 <noreply@anthropic.com>"
- **Branch**: Work on `orgoj` branch, NO publishing to crates.io (this is a fork)

### Code Quality Preferences:
- **Testing responsibility**: Developer tests their own work, NEVER ask user to test
- **Test sessions**: Use cc-test, cc-tmuxcc, or ct-multi for different scenarios
- **Build before claiming done**: `cargo build --release` and visual verification mandatory
- **Warnings**: Must run `cargo clippy` and fix all warnings

### Technical Preferences:
- **Library-first approach**: NEVER write from scratch, always research libraries first
- **Documentation via MCP**: Use rtfmbro for library docs (README, docs tree, examples)
- **No bash grep**: Use Grep tool (respects .gitignore) not `grep` command
- **Working directory discipline**: NEVER use `cd`, always use relative paths or subshells
- **Unicode safety**: Use `unicode-width` crate, NEVER byte slicing `&str[..n]`

### Communication Preferences:
- **Language**: User communicates in Czech (especially when correcting or frustrated)
- **Directness**: Prefers direct action over proposals when explicitly requested
- **No emojis**: Only use emojis if user explicitly requests (except in git commit messages)
- **Czech feedback patterns**:
  - "kurva" / "doprdele" = strong correction needed, fix immediately
  - "chapes?" = asking if I understand (not user's agreement)
  - "ja to nechci videt" = stop showing proposals, switch to direct action

## Code Patterns Used

**Config file handling:**
```toml
poll_interval_ms = 500
capture_lines = 200
agent_patterns = []  # Empty = use defaults
```

**Test script pattern:**
```bash
SESSION="ct-test"
PROJECT_DIR="/home/michael/work/ai/TOOLS/tmuxcc"

# Kill existing if present
tmux has-session -t "$SESSION" 2>/dev/null && tmux kill-session -t "$SESSION"

# Create and run
tmux new-session -d -s "$SESSION" -c "$PROJECT_DIR"
tmux send-keys -t "$SESSION" './target/release/tmuxcc' Enter
```

## Notes

- **tmuxcc vs tmuxclai**: This is a fork of nyanko3141592/tmuxcc, inspired by tmuxclai-arch vision
- **Publishing**: This is a FORK - only push to `orgoj` branch, NO crates.io publishing
- **Version**: Currently 0.1.7, allow dirty publish for Cargo.lock changes
- **Agent detection**: Works by process name, window title (‚ú≥ icon), child processes, version numbers
- **Session restart fixed detection**: Claude sessions now detected after tmux restart

**Next session priorities** (from TODO.md):
1. Fix 'f' key not focusing tmux session
2. Fix preview not showing end of pane (new insight: might be line wrapping issue)
3. Implement modal input dialog with tui-textarea
4. Add statusline for session info

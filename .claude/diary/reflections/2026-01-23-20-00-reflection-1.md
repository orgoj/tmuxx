# Reflection: Last 2 Entries (2026-01-23)

**Generated**: 2026-01-23 20:00
**Entries Analyzed**: 2
**Date Range**: 2026-01-23 11:11 to 2026-01-23 19:30

## Summary

Two diary entries reveal critical patterns in tmuxcc development workflow. The first session established project foundation with comprehensive documentation and proper library research (tui-textarea selection via WebSearch + rtfmbro). The second session revealed a significant diagnostic pattern: apparent feature failures often mask upstream problems (agent detection failure made focus feature appear broken). Both sessions show strong adherence to research-first development but reveal gaps in problem diagnosis and skill invocation discipline.

Key insight: Problems often have multiple interrelated root causes that should be addressed in ONE integrated plan, not separate fixes. Runtime testing via tmux-automation remains underutilized despite being explicitly documented in CLAUDE.md.

## Patterns Identified

### Strong Patterns (2/2 entries = 100%)

1. **Library Research Before Implementation** (2/2 entries)
   - Observation: Both sessions used WebSearch → rtfmbro MCP → study examples workflow before implementing features (tui-textarea selection, terminal emulator research for cross-session focus)
   - CLAUDE.md rule: Already documented in "Library Research Workflow" section
   - Action: Pattern successfully established, no changes needed

2. **Problem Misdiagnosis Due to Incomplete Initial Analysis** (2/2 entries)
   - Observation: Session 1 - tried wrong skill name instead of checking available skills list. Session 2 - analyzed keyboard handling code when real problem was NO agents detected (upstream data problem)
   - CLAUDE.md rule: `- tmux debugging: run diagnostic commands (tmux list-panes -a) BEFORE analyzing code - real data beats assumptions`
   - Action: ADD to "Common Pitfalls" section

3. **Plan Integration vs Separation Confusion** (2/2 entries)
   - Observation: Session 2 explicitly showed confusion about integrating two related problems (agent detection + cross-session focus) into ONE plan vs splitting/replacing
   - CLAUDE.md rule: `- Planning: when multiple problems are related, INTEGRATE into one cohesive plan - don't separate or replace`
   - Action: ADD new section or extend existing planning guidance

4. **Skill Invocation Discipline Violations** (2/2 entries)
   - Observation: Session 1 - used wrong skill name (tmux-automation vs tmux-automation:tmux-automation). Session 2 - didn't invoke tmux-automation skill at all despite CLAUDE.md saying "CRITICAL: YOU test yourself using tmux-automation skill!"
   - CLAUDE.md rule: Strengthen existing rule in "Testing" section
   - Action: STRENGTHEN "CRITICAL: YOU test yourself" rule - make it more emphatic about ACTUALLY invoking the skill

5. **Git Workflow Pattern** (2/2 entries)
   - Observation: Both sessions used `git add -A`, Co-Authored-By attribution, work on `orgoj` branch
   - CLAUDE.md rule: Already documented in "Git Workflow" section
   - Action: Pattern successfully established, no changes needed

### Rule Violations Detected

**Violation 1: tmux-automation skill not invoked** (Session 2)
- Rule: "CRITICAL: YOU test yourself using tmux-automation skill!" (CLAUDE.md line 164-169)
- Violation: Session 2 completed implementation and claimed testing success WITHOUT invoking tmux-automation skill
- Consequence: Testing was manual/ad-hoc instead of systematic
- Action: STRENGTHEN rule with explicit skill invocation requirement

**Violation 2: scripts/cp-bin.sh mentioned in discussion** (Session 1 diary notes)
- Rule: "scripts/cp-bin.sh - Install tmuxcc to ~/bin after build (DON'T USE - user has working version there!)" (CLAUDE.md line 160)
- Violation: No actual violation in action, but diary mentioned it for testing context
- Action: No change needed - warning worked

## Proposed CLAUDE.md Updates

### Common Pitfalls (ADD at end of section)

```markdown
6. **Upstream Data Problems**: When a feature "doesn't work", check if upstream data exists FIRST (e.g., agent detection before testing focus functionality)
```

### Testing Section (STRENGTHEN existing rule at line 164)

**BEFORE:**
```markdown
- **CRITICAL: YOU test yourself using tmux-automation skill!**
  - Use `./target/release/tmuxcc` for testing (never cp-bin.sh)
  - Use `scripts/reload-test.sh` to reload tmuxcc in ct-test session
  - Use tmux-automation skill to interact with TUI and verify behavior
  - **NEVER ask user to test** - testing is YOUR responsibility
  - **NEVER claim completion without runtime verification** - visual verification mandatory for UI features
```

**AFTER:**
```markdown
- **CRITICAL: YOU test yourself using tmux-automation skill - INVOKE IT, don't just mention it!**
  - Use `./target/release/tmuxcc` for testing (never cp-bin.sh)
  - Use `scripts/reload-test.sh` to reload tmuxcc in ct-test session
  - **INVOKE tmux-automation skill with Skill tool** - don't skip this step!
  - Use tmux-automation skill to interact with TUI and verify behavior
  - **NEVER ask user to test** - testing is YOUR responsibility
  - **NEVER claim completion without runtime verification** - visual verification mandatory for UI features
```

### Development Workflow Section (ADD new subsection after "Testing")

```markdown
### Problem Diagnosis

- **Run diagnostic commands FIRST**: Before analyzing code, gather real data (e.g., `tmux list-panes -a` when debugging detection)
- **Check upstream problems**: Feature failures often indicate missing input data, not broken feature logic
- **Integrate related problems**: Multiple related issues → ONE cohesive plan, not separate fixes or replacements
```

## Technical Insights

### Rust Patterns Worth Documenting

1. **Enum with associated data for dynamic typing**:
   - Pattern: `AgentType::Custom(String)` stores agent type name
   - Use case: When enum variant needs associated data (custom agent names)
   - Better than: `AgentType::Custom` without data (generic name)

2. **Config-driven registry initialization**:
   - Pattern: `ParserRegistry::with_config(config)` constructs registry from config
   - Use case: Loading custom patterns from user config
   - Design: Built-in parsers BEFORE custom patterns (priority matters)

3. **Environment variable session detection**:
   - Pattern: `std::env::var("TMUX").is_ok()` detects tmux context
   - Pattern: `tmux display-message -p '#S'` gets current session name
   - Use case: Cross-session navigation with `switch-client`

### tmux Command Patterns

1. **Cross-session focus**: `switch-client -t session:window.pane` (not just `select-pane`)
2. **Session detection**: `$TMUX` env var + `display-message -p '#S'`
3. **Detached session visibility**: Filtering by `session_attached == 1` hides detached sessions (problematic for multi-session monitoring)

## One-Off Observations

### Session 1 Only:
- Voice dictation from mobile produces garbled text requiring careful decoding
- User communicates in Czech when frustrated ("kurva", "doprdele")
- TODO organization: group related items (3+4 was one issue, 6+7 was one feature)

### Session 2 Only:
- Dead code detection: Config fields can exist but be completely unused (agent_patterns was defined but not integrated)
- Parser priority matters: Built-in parsers should come BEFORE custom patterns
- Regex wildcard: `*` → `.*` conversion for user-friendly pattern matching
- Session attached filter: Temporary fix removed filter, proper solution needs config option

## Metadata

**Entries analyzed:**
1. `.claude/diary/2026-01-23-11-11-767a7006.md` - Project initialization and library research
2. `.claude/diary/2026-01-23-19-30-5e97e687.md` - Agent detection and cross-session focus implementation

**Pattern confidence:**
- High (2/2 = 100%): Library research, problem misdiagnosis, planning confusion, skill violations, git workflow
- Note: Only 2 entries analyzed - patterns should be monitored across more sessions to confirm

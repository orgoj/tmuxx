 â”‚ zai-cli v1.1.0 - CLI for Z.AI MCP services

 Usage: zai-cli <command> [args] [options]

 Commands:
   vision   Image and video analysis (MCP)
   search   Real-time web search
   read     Fetch and parse web pages
   repo     GitHub repository exploration
   tools    List available MCP tools
   tool     Show a tool schema
   call     Call a tool directly
   doctor   Environment + connectivity checks
   code     Execute TypeScript tool chains (Code Mode)

 Global Options:
   --output-format <data|json|pretty>  Output mode (default: data)

 Help:
   zai-cli --help
   zai-cli vision --help
   zai-cli search --help
   zai-cli read --help
   zai-cli repo --help
   zai-cli tools --help
   zai-cli call --help
   zai-cli code --help




 $ zai-cli --version

 1.1.0




 $ zai-cli search "python pytest best practices 2025 modular projects"

 ... (13 earlier lines, ctrl+o to expand)
 Developers","url":"https://blog.devgenius.io/pytest-in-2025-a-complete-guide-for-python-developers-9b15ae0fe07e","summary":"In this guide, I'll show you the basics of pytest what you need to know, share useful
 tips, and ll show you how to write clean, maintainable tests.","date":"2025å¹´3æœˆ25æ—¥"},{"rank":9,"title":"Structuring Your Python Project in 2025: A Modern
 Approach","url":"https://sirawats.com/post/Structuring-Your-Python-Project-in-2025","summary":"You're not expected to grasp every nuance right away; think of this as a guided tour through the evolution of Python
 project structure, peppered with insights ..."},{"rank":10,"title":"Building a Python testing framework","url":"https://fluidattacks.com/blog/building-python-testing-framework","summary":"At Fluid Attacks, we
 built an internal testing framework to improve our tests in Python. Let's talk about our motivation and results.","date":"2025å¹´1æœˆ15æ—¥"}]




 $ zai-cli search "pytest mock dnspython httpx best practices 2025"

 ... (13 earlier lines, ctrl+o to expand)
 API routes with Pydantic models for validation, and FastOpenAPI handles the rest, generating OpenAPI schemas, validating ...","date":"7å¤©å‰"},{"rank":9,"title":"Python HTTP Clients: Requests vs. HTTPX vs.
 AIOHTTP","url":"https://www.speakeasy.com/blog/python-http-clients-requests-vs-httpx-vs-aiohttp","summary":"Let's compare these three popular HTTP clients for Python: Requests, HTTPX, and AIOHTTP. We'll explore
 their strengths, weaknesses, and ideal use cases.","date":"2024å¹´8æœˆ23æ—¥"},{"rank":10,"title":"Two Real-World Cases You Should Master (HTTP +
 S3)","url":"https://medium.com/@gema.correa/mocking-in-python-two-real-world-cases-you-should-master-http-s3-d5a0d7695d0e","summary":"Uses respx to mock HTTP calls made by httpx . Defines a mocked response for
 the request. Calls the real function and checks that the data ..."}]


 DÃ­ky pouÅ¾itÃ­ zai-cli k ovÄ›Å™enÃ­ aktuÃ¡lnÃ­ch trendÅ¯ v Python testovÃ¡nÃ­ pro rok 2025 (pytest, httpx, uv) jsem pro tebe pÅ™ipravil hloubkovou analÃ½zu tvÃ½ch testÅ¯.

 Zde je srovnÃ¡nÃ­ tvÃ©ho projektu s modernÃ­mi best-practices:

 ### 1. Architektura a Layout (VynikajÃ­cÃ­ âœ…)

 - Best Practice: PouÅ¾itÃ­ src/ layoutu a pyproject.toml.
 - TvÅ¯j stav: Projekt toto splÅˆuje na 100 %. PouÅ¾itÃ­ uv jako package manageru je v roce 2025 standardem pro rychlost a determinismus.
 - Verdikt: ZÃ¡klad je Å¡piÄkovÃ½.

 ### 2. Izolace a MockovÃ¡nÃ­ (SlabÅ¡Ã­ mÃ­sto âš ï¸ )

 - Best Practice: PouÅ¾itÃ­ specializovanÃ½ch knihoven pro simulaci sÃ­tÄ›, jako je pytest-httpx nebo respx pro HTTP volÃ¡nÃ­.
 - TvÅ¯j stav: VÄ›tÅ¡ina tvÃ½ch testÅ¯ se sÃ­ti vyhÃ½bÃ¡ tÃ­m, Å¾e testuje jen "jestli jde objekt vytvoÅ™it". TÃ­m ale netestujeÅ¡ to nejdÅ¯leÅ¾itÄ›jÅ¡Ã­ â€“ logiku zpracovÃ¡nÃ­ dat.
 - DoporuÄenÃ­:
     - MÃ­sto manuÃ¡lnÃ­ho patchovÃ¡nÃ­ v kaÅ¾dÃ©m testu pouÅ¾ij pytest-httpx (kterÃ½ uÅ¾ mÃ¡Å¡ v pyproject.toml v dev zÃ¡vislostech) pro vÅ¡echny testy v http_analyzer, ssl_analyzer atd.
     - VytvoÅ™ si v tests/conftest.py globÃ¡lnÃ­ fixtures pro DNS odpovÄ›di, aby kaÅ¾dÃ½ novÃ½ test nemusel znovu definovat sloÅ¾itÃ© MagicMock objekty.

 ### 3. AAA Pattern & Parametrizace (StÅ™ednÃ­ ğŸ’¡)

 - Best Practice: PouÅ¾Ã­vat @pytest.mark.parametrize pro testovÃ¡nÃ­ vÃ­ce domÃ©n najednou a dodrÅ¾ovat AAA pattern (Arrange, Act, Assert).
 - TvÅ¯j stav: TvÅ¯j kÃ³d v tests/test_analyzer_instantiation.py obsahuje hodnÄ› repetitivnÃ­ho kÃ³du.
 - DoporuÄenÃ­: PÅ™epiÅ¡ testy instancovÃ¡nÃ­ na jeden parametrizovanÃ½ test:
   ```python
     @pytest.mark.parametrize("analyzer_class", [DNSAnalyzer, HTTPAnalyzer, SSLAnalyzer])
     def test_analyzer_protocol(analyzer_class):
         instance = analyzer_class()
         assert hasattr(instance, "analyze")
         # ... atd.
   ```
   TÃ­m uÅ¡etÅ™Ã­Å¡ 100 Å™Ã¡dkÅ¯ kÃ³du a snadnÄ›ji pÅ™idÃ¡Å¡ dalÅ¡Ã­ moduly.

 ### 4. IntegraÄnÃ­ vs Unit Testy (DobrÃ© rozdÄ›lenÃ­ âœ…)

 - Best Practice: JasnÃ© oddÄ›lenÃ­ rychlÃ½ch unit testÅ¯ od pomalejÅ¡Ã­ch integraÄnÃ­ch (CLI) testÅ¯.
 - TvÅ¯j stav: MÃ¡Å¡ test_integration_workflow.py a test_cli_*.py. To je sprÃ¡vnÄ›.
 - DoporuÄenÃ­: PÅ™idej do pyproject.toml markery, abys mohl spouÅ¡tÄ›t jen rychlÃ© testy: pytest -m "not integration".

 ### 5. Co tvÃ½m testÅ¯m chybÃ­ nejvÃ­ce? (ChybÄ›jÃ­cÃ­ kousky ğŸ§©)

 - tests/conftest.py: Tento soubor je v pytestu "srdcem" testovacÃ­ sady. UmoÅ¾Åˆuje sdÃ­let nastavenÃ­ (fixtures) mezi soubory. TvÅ¯j projekt ho zatÃ­m nemÃ¡.
 - Flet / GUI Testing: MÃ¡Å¡ tam test_flet_app_cli.py, ale skuteÄnÃ© testovÃ¡nÃ­ UI (klikÃ¡nÃ­ na tlaÄÃ­tka) tam chybÃ­. Pro Flet se v roce 2025 doporuÄuje testovat logiku v State tÅ™Ã­dÃ¡ch oddÄ›lenÄ› od UI komponent.

 â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

 ### ShrnutÃ­ a akÄnÃ­ kroky:

 TvÃ© testy jsou "architektonicky sprÃ¡vnÃ©, ale obsahovÄ› chudÃ©". MÃ¡Å¡ skvÄ›lou kostru, ale reÃ¡lnÄ› testujeÅ¡ jen malou ÄÃ¡st funkÄnosti (pokrytÃ­ 20 %).

 Pokud chceÅ¡, mÅ¯Å¾u pro tebe udÄ›lat jednu z tÄ›chto vÄ›cÃ­:
 1. VytvoÅ™it tests/conftest.py s ukÃ¡zkou modernÃ­ch fixtures pro DNS a HTTP.
 2. Refaktorovat test_analyzer_instantiation.py pomocÃ­ parametrizace, aby byl kÃ³d ÄistÅ¡Ã­.
 3. Napsat komplexnÃ­ test pro Email Security (SPF/DKIM/DMARC), coÅ¾ je nejkomplexnÄ›jÅ¡Ã­ ÄÃ¡st tvÃ© logiky.

 Co si vybereÅ¡?


 2


 PÅ™epracuji tests/test_analyzer_instantiation.py tak, aby vyuÅ¾Ã­val sÃ­lu pytest parametrizace. TÃ­m odstranÃ­me redundantnÃ­ kÃ³d a zajistÃ­me, Å¾e kaÅ¾dÃ½ novÃ½ analyzÃ©r bude automaticky testovÃ¡n proti stejnÃ©mu standardu
 (Protocolu).

 NejdÅ™Ã­ve si ovÄ›Å™Ã­m seznam vÅ¡ech analyzÃ©rÅ¯ v projektu.



 $ ls src/webmaster_domain_tool/analyzers/*.py | grep -v "__init__.py" | grep -v "protocol.py" | grep -v "base.py" | grep -v "utils.py"

 ... (8 earlier lines, ctrl+o to expand)
 src/webmaster_domain_tool/analyzers/security_headers.py
 src/webmaster_domain_tool/analyzers/seo_files_analyzer.py
 src/webmaster_domain_tool/analyzers/site_verification_analyzer.py
 src/webmaster_domain_tool/analyzers/ssl_analyzer.py
 src/webmaster_domain_tool/analyzers/whois_analyzer.py



 read src/webmaster_domain_tool/analyzers/cdn_detector.py

 """CDN detection analyzer - identify CDN providers.

 This analyzer detects CDN usage from HTTP headers and DNS CNAME records.
 Completely self-contained with config, logic, and output formatting.
 """

 import logging
 from dataclasses import dataclass, field

 from pydantic import Field
 ... (446 more lines, ctrl+o to expand)



 write tests/test_analyzer_instantiation.py

 """Test that all registered analyzers properly implement the AnalyzerPlugin protocol.

 This module uses pytest parametrization to automatically test all analyzers
 discovered by the registry. This ensures that any new analyzer added to the
 project follows the required interface.
 """

 import pytest

 # Import analyzers package to trigger auto-registration of all modules
 ... (74 more lines, 84 total, ctrl+o to expand)




 $ .venv/bin/python3 -m pytest tests/test_analyzer_instantiation.py -v

 ... (103 earlier lines, ctrl+o to expand)
 src/webmaster_domain_tool/utils/debug_stats.py                        112     79    29%   66-69, 74-78, 82-83, 87, 91, 95-98, 120-133, 157-176, 189-235, 241
 src/webmaster_domain_tool/utils/logger.py                              16     12    25%   23-54
 -------------------------------------------------------------------------------------------------
 TOTAL                                                                5954   4897    18%
 ============================== 54 passed in 1.19s ==============================


 Hotovo. Refaktoroval jsem tests/test_analyzer_instantiation.py a vÃ½sledek je mnohem ÄistÅ¡Ã­ a efektivnÄ›jÅ¡Ã­:

 ### HlavnÃ­ vylepÅ¡enÃ­:

 1. AutomatickÃ¡ detekce (Zero-Touch): Test nynÃ­ vyuÅ¾Ã­vÃ¡ vnitÅ™nÃ­ registry projektu. Pokud do sloÅ¾ky analyzers/ pÅ™idÃ¡Å¡ jakÃ½koliv novÃ½ soubor s dekodÃ©rem @registry.register, test ho automaticky najde a otestuje bez
 nutnosti Ãºpravy testovacÃ­ho souboru.
 2. Parametrizace: MÃ­sto 11 tÃ©mÄ›Å™ identickÃ½ch testovacÃ­ch funkcÃ­ mÃ¡me nynÃ­ jednu tÅ™Ã­du TestAnalyzerProtocols, kterÃ¡ prochÃ¡zÃ­ vÅ¡echny analyzÃ©ry dynamicky.
 3. HloubkovÃ¡ kontrola: Test nynÃ­ ovÄ›Å™uje nejen existenci metod, ale i:
     - VÅ¡echna povinnÃ¡ metadata (id, name, category, icon).
     - SprÃ¡vnou dÄ›diÄnost konfiguraÄnÃ­ tÅ™Ã­dy od Pydantic BaseModel.
     - Schopnost ÄistÃ© instanciace.
 4. SpeciÃ¡lnÃ­ pÅ™Ã­pady: Ponechal jsem testy pro specifickÃ© metody (napÅ™. v CDNDetector nebo SecurityHeadersAnalyzer), kterÃ© jdou nad rÃ¡mec zÃ¡kladnÃ­ho protokolu.

 VÃ½sledek: MÃ¡me 54 testovacÃ­ch pÅ™Ã­padÅ¯, kterÃ© probÄ›hly za 1.19s. PokrÃ½vajÃ­ celou rodinu tvÃ½ch analyzÃ©rÅ¯ a garantujÃ­, Å¾e kaÅ¾dÃ½ z nich dodrÅ¾uje stanovenÃ© rozhranÃ­.

 ChceÅ¡ nynÃ­ pÅ™ejÃ­t k bodu 1 a vytvoÅ™it tests/conftest.py, aby se ti v budoucnu lÃ©pe psaly testy s mockovÃ¡nÃ­m sÃ­tÄ›?

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
~/work/ai/PROJECTS/webmaster-domain-tools (dev-pi)
â†‘294k â†“16k R1.0M $0.708 (sub) 6.0%/1.0M (auto)                                                                                                                                                         gemini-3-flash



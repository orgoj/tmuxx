# tmuxx default configuration
# Note: Structural detection is used instead of line counts for robust agent monitoring.

poll_interval_ms = 500
cyclic_navigation = false
capture_lines = 200
show_detached_sessions = true
debug_mode = false
truncate_long_lines = true
popup_trigger_key = "/"
ignore_self = true
log_actions = true
hide_bottom_input = true
terminal_wrapper = ""

todo_full_width = true
agent_name_color = "#000000"
current_item_bg_color = "#cacaca"
sidebar_width = 60
capture_buffer_size = 16384

# Notification settings (disabled by default - no command configured)
# Uncomment and set your notification command to enable:
# notification_command = "notify-send -u critical 'tmuxx' '{message}'"
notification_delay_ms = 60000
notification_mode = "first"

[indicators]
idle = "‚óè"
processing = "‚óê"
approval = "‚ö†"
error = "‚úó"
unknown = "?"
subagent_running = "‚ñ∂"
subagent_completed = "‚úì"
subagent_failed = "‚úó"
spinner = ["‚†ã", "‚†ô", "‚†π", "‚†∏", "‚†º", "‚†¥", "‚†¶", "‚†ß", "‚†á", "‚†è"]

[timing]
tick_interval_ms = 80
hysteresis_ms = 2000

[messages]
welcome = "tmuxx v{version} [{color_mode}] - Press ? for help"
approval_prompt = "‚ö† {agent_type} wants: {approval_type}\n\nDetails: {details}\n\nPress {approve_key} to approve or {reject_key} to reject"
label_todo = "Project TODO:"
label_tasks = "Tasks:"
label_tools = "Tools:"
label_sel = "sel"
label_pending = "pending"
label_subs = "subs"
label_agents = "agents"

# Display TODO from project files (TODO.md, etc.)
todo_from_file = true
todo_files = ["TODO.md", "NOTES.md", "TASKS.md", "README.md"]

[[agents]]
id = "claude"
name = "Claude"
background_color = "#fce4fc"
priority = 100
  default_type = "working"

  [[agents.matchers]]
  type = "command"
  pattern = "(?i)claude|anthropic|claude-code"

  [[agents.matchers]]
  type = "ancestor"
  pattern = "(?i)claude|anthropic|claude-code"

  [[agents.process_indicators]]
  ancestor_pattern = "ssh"
  icon = "üåê"

  [[agents.process_indicators]]
  ancestor_pattern = "docker"
  icon = "üê≥"

  [[agents.process_indicators]]
  ancestor_pattern = "nix-shell"
  icon = "‚ùÑ"

  # ==========================================================================
  # CLAUDE STATE DETECTION (Admin Notes)
  # ==========================================================================
  # 1. Structural Split: Find the prompt area (‚îÄ‚îÄ‚îÄ line) from bottom.
  # 2. Working: Spinner on FIRST line of LAST block in body has top priority.
  # 3. Approval: TUI menus (Esc to cancel) or Yes/No prompts (‚ùØ 1. Yes) 
  #    are detected in both body and prompt groups.
  # 4. Idle: Default state if no refinements match after splitting.
  # ==========================================================================

  [[agents.state_rules]]
  status = "idle"
  type = "idle"
  last_lines = 40
  splitter = "separator_line"

  # --- WORKING (Checks first line of last block in response body) ---
  # Matches spinner chars followed by any text ending in ellipsis (‚Ä¶)
  # Examples: "‚úª Coalescing‚Ä¶", "* Mulling‚Ä¶", "‚ú¢ Processing simple-backup skill‚Ä¶"
  [[agents.state_rules.refinements]]
  group = "body"
  location = "first_line_of_last_block"
  pattern = '''[‚úΩ‚úª‚ú¢*‚à¥‚è∫‚óè¬∑‚ú∂].*‚Ä¶'''
  status = "working"
  type = "working"

  # --- ACTION REQUIRED (TUI menu in prompt area) ---
  [[agents.state_rules.refinements]]
  group = "prompt"
  pattern = '''(?:Enter to select|Esc to cancel|‚ùØ\s*1\.\s*Yes|approve edits)'''
  status = "menu"
  type = "approval"

  # --- ACTION REQUIRED (TUI menu in body area) ---
  [[agents.state_rules.refinements]]
  group = "body"
  pattern = '''(?:Enter to select|Esc to cancel|‚ùØ\s*1\.\s*Yes|approve edits)'''
  status = "menu"
  type = "approval"

  # --- UNFINISHED TASKS (in last block only) ---
  [[agents.state_rules.refinements]]
  group = "body"
  location = "last_block"
  pattern = '''‚óª|unfinished tasks'''
  status = "unfinished tasks"
  type = "approval"

  # --- INTERRUPTED (User pressed Esc, Claude awaits instructions) ---
  [[agents.state_rules.refinements]]
  group = "body"
  pattern = '''Interrupted.*What should Claude do'''
  status = "interrupted"
  type = "approval"

  # --- ACTIVE PROMPT (Force Idle if prompt is empty) ---
  [[agents.state_rules.refinements]]
  group = "prompt"
  pattern = '''(?m)^‚ùØ\s*$'''
  status = "idle"
  type = "idle"

  # --- PENDING EDITS (System msg in footer) ---
  [[agents.state_rules.refinements]]
  group = "prompt"
  pattern = '''(?m)^[^‚ùØ]*‚èµ‚èµ accept edits'''
  status = "edits pending"
  type = "approval"

  [agents.subagent_rules]
  start = '''(?m)[‚è∫‚†ø‚†á‚†ã‚†ô‚†∏‚†¥‚†¶‚†ß‚†ñ‚†è]\s*Task\s*\([^)]*subagent_type\s*[:=]\s*["']?(\w[\w-]*)["']?[^)]*description\s*[:=]\s*["']([^"']+)["']'''
  running = '''(?m)^[^‚îÇ]*[‚ñ∂‚ñ∫‚†ø‚†á‚†ã‚†ô‚†∏‚†¥‚†¶‚†ß‚†ñ‚†è]\s*(\w+)(?:\s*agent)?:?\s*(.*)$'''
  complete = '''(?m)[‚úì‚úî]\s*(\w+).*?(?:completed|finished|done|returned)'''

  [agents.summary_rules]
  activity = '''(?m)^[ \t]*[‚îÇ]*[ \t]*[‚úΩ¬∑][ \t]*(.*?)(?:[ \t]*\(.*?\))?[ \t]*$'''
  task_pending = '''(?m)^[ \t]*[‚îÇ]*[ \t]*‚òê[ \t]*(.*)$'''
  task_completed = '''(?m)^[ \t]*[‚îÇ]*[ \t]*[‚òë‚úì][ \t]*(.*)$'''
  tool_use = '''(?m)^[ \t]*[‚îÇ]*[ \t]*‚è∫[ \t]*(?:[Cc]ompleted[ \t]+)?(.*?)(?:[ \t]*\(.*?\))?[ \t]*$'''

  [[agents.highlight_rules]]
  pattern = '''^\+.*'''
  color = "green"
  [[agents.highlight_rules]]
  pattern = '''^-.*'''
  color = "red"
  [[agents.highlight_rules]]
  pattern = '''^@@.*'''
  color = "cyan"
  [[agents.highlight_rules]]
  pattern = '''(?i)\[y/n\]'''
  color = "yellow"
  [[agents.highlight_rules]]
  pattern = '''(?i)‚ö†|error'''
  color = "red"
  [[agents.highlight_rules]]
  pattern = '''^[‚ùØ>].*'''
  color = "cyan"

  [agents.keys]
  approve = ["y", "Enter"]
  reject = ["n", "Enter"]
  number = ["{n}"]  # Claude menus select on number press, no Enter needed
  input = ["{input}", "Enter"]

[[agents]]
id = "pi-powerline"
name = "Pi (Powerline)"
background_color = "#eef2ff"
priority = 96
  default_type = "working"

  [[agents.matchers]]
  type = "content"
  pattern = "[‚ï≠‚ï∞ÓÇ∂ÓÇ¥]"

  # Rule 0: Dippy Approval (highest priority)
  [[agents.state_rules]]
  status = "Dippy Approval"
  type = "approval"
  last_lines = 40
  pattern = '''‚Üë‚Üì navigate'''

  [[agents.state_rules]]
  status = "idle"
  type = "idle"
  last_lines = 40
  splitter = "powerline_box"

  # --- Question ---
  [[agents.state_rules.refinements]]
  group = "body"
  location = "last_line"
  pattern = '''\?'''
  status = "Question"
  type = "approval"

  # --- WORKING (High Priority) ---
  [[agents.state_rules.refinements]]
  group = "body"
  location = "last_line"
  pattern = '''[\u2800-\u28FF*‚úª‚à¥‚è∫‚ú¢‚óª‚ñ∂‚ñ∫]|Working'''
  status = "Working..."
  type = "working"

  # --- Error ---
  [[agents.state_rules.refinements]]
  group = "body"
  location = "last_line"
  pattern = '''Command exited with code [1-9]'''
  status = "Error"
  type = "error"

[[agents]]
id = "pi"
name = "Pi"
background_color = "#eef2ff"
priority = 95
  default_type = "working"

  [[agents.matchers]]
  type = "command"
  pattern = "(?i)^pi$"

  [[agents.matchers]]
  type = "title"
  pattern = "(?i)^œÄ"

  # ==========================================================================
  # Pi State Detection
  # ==========================================================================

  # Rule 0: Dippy Approval (highest priority)
  [[agents.state_rules]]
  status = "Dippy Approval"
  type = "approval"
  last_lines = 40
  pattern = '''‚Üë‚Üì navigate'''

  # Rule 1: Main structural detection
  [[agents.state_rules]]
  status = "idle"
  type = "idle"
  last_lines = 40
  splitter = "separator_line"

  # --- WORKING (Highest Priority in body) ---
  [[agents.state_rules.refinements]]
  group = "body"
  location = "last_line"
  pattern = '''[\u2800-\u28FF*‚úª‚à¥‚è∫‚ú¢‚óª‚ñ∂‚ñ∫]|Working'''
  status = "Working..."
  type = "working"

  # --- Question ---
  [[agents.state_rules.refinements]]
  group = "body"
  location = "last_line"
  pattern = '''\?'''
  status = "Question"
  type = "approval"

  # --- Error ---
  [[agents.state_rules.refinements]]
  group = "body"
  location = "last_line"
  pattern = '''Command exited with code [1-9]'''
  status = "Error"
  type = "error"

[[agents]]
id = "gemini"
name = "Gemini"
background_color = "#fcfce0"
priority = 90
  default_type = "working"

  [[agents.matchers]]
  type = "command"
  pattern = "(?i)gemini|google"

  [[agents.matchers]]
  type = "ancestor"
  pattern = "(?i)gemini"

  [[agents.matchers]]
  type = "content"
  pattern = '''(?i)no sandbox \(see /docs\)|[\w.-]+ /model'''

  [[agents.process_indicators]]
  ancestor_pattern = "ssh"
  icon = "üåê"

  [[agents.state_rules]]
  status = "idle"
  type = "idle"
  last_lines = 100
  pattern = '''(?s).*[>]\s*(?:Type your message or @path/to/file)?.* /model\s*\z'''
  splitter = "none"

  [[agents.state_rules.refinements]]
  group = "body"
  location = "last_line"
  pattern = '''‚ú¶|Working|Thinking'''
  status = "Working..."
  type = "working"

  [[agents.state_rules.refinements]]
  group = "body"
  pattern = '''(?m)^> \s*$'''
  status = "idle"
  type = "idle"

  [[agents.state_rules.refinements]]
  group = "body"
  location = "last_line"
  pattern = '''\?'''
  status = "Question"
  type = "approval"


[[agents]]
id = "opencode"
name = "OpenCode"
background_color = "#e6f3ff"
priority = 85
  [[agents.matchers]]
  type = "command"
  pattern = "(?i)opencode|open-code"
  [[agents.state_rules]]
  status = "OpenCode"
  type = "idle"
  pattern = '''(?s).*[>]\s*\z'''

[[agents]]
id = "codex_cli"
name = "Codex"
background_color = "#eaffea"
priority = 80
  [[agents.matchers]]
  type = "command"
  pattern = "(?i)codex|openai"
  [[agents.state_rules]]
  status = "Codex"
  type = "idle"
  pattern = '''(?s).*[>]\s*\z'''

[[agents]]
id = "generic_shell"
name = "shell"
is_ai = false
background_color = "#eaffe3"
priority = 10
  # Default for Terminal: if no prompt is seen, it's busy (processing)
  default_type = "working"
  [[agents.matchers]]
  type = "command"
  pattern = ".*"
  [[agents.state_rules]]
  status = "mc"
  type = "idle"
  last_lines = 3
  pattern = '''(?m)^ 1Help\s+2Menu\s+3View\s+4Edit\s+5Copy\s+6RenMov'''
  [[agents.state_rules]]
  status = "htop"
  type = "idle"
  last_lines = 3
  pattern = '''(?m)^(?:F1| 1)Help\s+F?2Setup\s+F?3Search\s+F?4Filter\s+F?5'''
  [[agents.state_rules]]
  status = "vim"
  type = "idle"
  last_lines = 3
  pattern = '''(?m)^-- (?:INSERT|VISUAL|REPLACE) --|\[[0-9]+\]\s+[0-9]+%\s+L:[0-9]+\s+C:[0-9]+'''
  [[agents.state_rules]]
  status = "tui"
  type = "idle"
  last_lines = 3
  pattern = '''[‚îÇ‚îå‚îê‚îî‚îò‚îú‚î§‚î¨‚î¥‚îº‚ïê‚ïë‚ïî‚ïó‚ïö‚ïù‚ï†‚ï£‚ï¶‚ï©‚ï¨]'''
  [[agents.state_rules]]
  status = "Err"
  type = "error"
  last_lines = 300
  pattern = '''(?s).*\d+\s+x\s*\z'''
  [[agents.state_rules]]
  status = "shell"
  type = "idle"
  last_lines = 300
  pattern = '''(?s).*[$#%>‚ùØ]\s*\z'''

[prompts]
  [[prompts.items]]
  name = "commit"
  text = "commit"
  [[prompts.items]]
  name = "continue"
  text = "continue"
  [[prompts.items]]
  name = "use internal tools!"
  text = "use internal tools!"

[pane_tree]
mode = "full"
header_template = " ‚ñº {session}"
session_header_fg_color = "white"
session_header_bg_color = "darkgray"
compact_template = "  {selection}{window_id}:{window_name} ‚îÇ {status_char} {name} {status_text}"
full_template = '''  {selection}{status_char} {name}
    {status_text} | pid:{pid} | {uptime}
    {path} {context}
{subagents}'''

[key_bindings]
"Home" = { navigate = "first_agent" }
"End" = { navigate = "last_agent" }
"Enter" = { send_keys = "Enter" }
"c" = "toggle_pane_tree_mode"
"y" = "approve"
"Y" = "approve"
"n" = "reject"
"N" = "reject"
"a" = "approve_all"
"A" = "approve_all"
"E" = { send_keys = "Escape" }
"C" = { send_keys = "C-c" }
"D" = { send_keys = "C-d" }
"K" = { kill_app = { method = "respawn" } }
"r" = "rename_session"
"C-l" = "refresh"
"C-s" = "capture_test_case"
"0" = { send_number = 0 }
"1" = { send_number = 1 }
"2" = { send_number = 2 }
"3" = { send_number = 3 }
"4" = { send_number = 4 }
"5" = { send_number = 5 }
"6" = { send_number = 6 }
"7" = { send_number = 7 }
"8" = { send_number = 8 }
"9" = { send_number = 9 }
"m" = "toggle_menu"
"p" = "toggle_prompts"
"s" = "toggle_filter_selected"
"x" = "toggle_filter_active"
"S" = "toggle_subagent_log"
"X" = "kill_session"
"C-r" = "reload_config"

# These are loaded first, then overridden by user config.
poll_interval_ms = 500
capture_lines = 200
show_detached_sessions = true
debug_mode = false
truncate_long_lines = true
popup_trigger_key = "/"
ignore_self = true
log_actions = true
hide_bottom_input = true
agent_name_color = "#000000"
current_item_bg_color = "#aaaaaa"
sidebar_width = 60
capture_buffer_size = 16384

[indicators]
idle = "●"
processing = "◐"
approval = "⚠"
error = "✗"
unknown = "?"
subagent_running = "▶"
subagent_completed = "✓"
subagent_failed = "✗"
spinner = ["⠋", "⠙", "⠹", "⠸", "⠼", "⠴", "⠦", "⠧", "⠇", "⠏"]

[timing]
tick_interval_ms = 80
hysteresis_ms = 2000

[messages]
welcome = "tmuxcc v{version} [{color_mode}] - Press ? for help"
approval_prompt = "⚠ {agent_type} wants: {approval_type}\n\nDetails: {details}\n\nPress {approve_key} to approve or {reject_key} to reject"
label_todo = "Project TODO:"
label_tasks = "Tasks:"
label_tools = "Tools:"
label_sel = "sel"
label_pending = "pending"
label_subs = "subs"
label_agents = "agents"

# Display TODO from project files (TODO.md, etc.)
todo_from_file = true
todo_files = ["TODO.md", "NOTES.md", "TASKS.md", "README.md"]

[[agents]]
id = "claude"
name = "Claude"
background_color = "#fce4fc"
priority = 100
  default_type = "working"

  [[agents.matchers]]
  type = "command"
  pattern = "(?i)claude|anthropic|claude-code"

  [[agents.matchers]]
  type = "ancestor"
  pattern = "(?i)claude|anthropic|claude-code"

  # 1. Structural Prompt Block (Synthesis/Contextual)
  # Recognizes the two lines with the prompt between them.
  # Determines state based on the indicator block ABOVE the separator.
  # NOTE: Layout stripping removes the footer region, so we match up to the prompt.
  [[agents.state_rules]]
  status = "idle"
  type = "idle"
  # Capture everything up to the separator as indicator. Handle optional │ in separators.
  pattern = '''(?ms)(?P<indicator>.*)(?:^|\n)[ \t]*[│]*[─╌]{10,}.*?(?:$|\n)(?P<body>.*?)(?:^|\n)[ \t]*[│]*[^\n]*?❯(?P<suffix>.*)$'''

  # Refinement: Detect questions in the body to switch to awaiting_approval
  [[agents.state_rules.refinements]]
  group = "body"
  pattern = "(?i)Do you want to|wants to exit.*?mode|Exit.*?mode\\?|confirm|Would you like to"
  status = "confirm"
  type = "approval"
  [[agents.state_rules.refinements]]
  group = "indicator"
  pattern = '''(?is)(?:Mulling|Thinking|Esc to interrupt|✢|∴)[^\n]*(?:\n[^\n]*){0,1}\s*\z'''
  status = "Thinking"
  type = "working"
  [[agents.state_rules.refinements]]
  group = "suffix"
  pattern = "(?i)Enter to select"
  status = "approval"
  type = "approval"

  [[agents.state_rules.refinements]]
  group = "indicator"
  pattern = '''(?i)Tasks\s*\(\d+\s+done,\s+[1-9]\d*\s+open\)'''
  status = "Tasks Pending"
  type = "approval"

  # 2. Specialized Approvals
  [[agents.state_rules]]
  status = "edit"
  type = "approval"
  approval_type = "edit"
  pattern = '''(?i)(?:Edit|Write|Modify)\s+.*?\?|Do you want to (?:edit|write|modify)|Allow.*?edit'''

  [[agents.state_rules]]
  status = "create"
  type = "approval"
  approval_type = "create"
  pattern = '''(?i)Create\s+.*?\?|Do you want to create|Allow.*?create'''

  [[agents.state_rules]]
  status = "delete"
  type = "approval"
  approval_type = "delete"
  pattern = '''(?i)Delete\s+.*?\?|Do you want to delete|Allow.*?delete'''

  [[agents.state_rules]]
  status = "shell"
  type = "approval"
  approval_type = "shell"
  pattern = '''(?i)(?:Run|Execute)\s+(?:command|bash|shell)|Do you want to run|Allow.*?(?:command|bash)|run this command'''

  [[agents.state_rules]]
  status = "mcp"
  type = "approval"
  approval_type = "mcp"
  pattern = '''(?i)MCP\s+tool|Do you want to use.*?MCP|Allow.*?MCP'''

  [[agents.state_rules]]
  status = "question"
  type = "approval"
  pattern = '''(?ms)(?<details>Let me ask you.*?)(\n\s*Enter to select\s*[\n\r]*\z)'''

  # 3. Legacy Input Detection (Fallback)
  [[agents.state_rules]]
  status = "Claude Code"
  type = "idle"
  pattern = '''(?s).*[❯]\s*\z'''

  # 4. Processing Indicators (Manual)
  [[agents.state_rules]]
  status = "Thinking"
  type = "working"
  last_lines = 20
  pattern = '''(?mx)
    (?:
      ^[ \t]*[✽⎿✻✢*∴]\s+.*   # Spinner or continuation (Added ✢, *, ∴)
      |
      (?:Mulling|Thinking)…
      |
      ^[ \t]*●\s+.*      # Tool use bullet
      |
      \(Esc\s+to\s+interrupt # Generic footer
    )
  '''

  [agents.subagent_rules]
  start = '''(?m)[⏺⠿⠇⠋⠙⠸⠴⠦⠧⠖⠏]\s*Task\s*\([^)]*subagent_type\s*[:=]\s*["']?(\w[\w-]*)["']?[^)]*description\s*[:=]\s*["']([^"']+)["']'''
  running = '''(?m)^[^│]*[▶►⠿⠇⠋⠙⠸⠴⠦⠧⠖⠏]\s*(\w+)(?:\s*agent)?:?\s*(.*)$'''
  complete = '''(?m)[✓✔]\s*(\w+).*?(?:completed|finished|done|returned)'''

  [agents.summary_rules]
  activity = '''(?m)^[ \t]*[│]*[ \t]*[✽·][ \t]*(.*?)(?:[ \t]*\(.*?\))?[ \t]*$'''
  task_pending = '''(?m)^[ \t]*[│]*[ \t]*☐[ \t]*(.*)$'''
  task_completed = '''(?m)^[ \t]*[│]*[ \t]*[☑✓][ \t]*(.*)$'''
  tool_use = '''(?m)^[ \t]*[│]*[ \t]*⏺[ \t]*(?:[Cc]ompleted[ \t]+)?(.*?)(?:[ \t]*\(.*?\))?[ \t]*$'''

  [[agents.highlight_rules]]
  pattern = '''^\+.*'''
  color = "green"

  [[agents.highlight_rules]]
  pattern = '''^-.*'''
  color = "red"

  [[agents.highlight_rules]]
  pattern = '''^@@.*'''
  color = "cyan"

  [[agents.highlight_rules]]
  pattern = '''(?i)\[y/n\]'''
  color = "yellow"

  [[agents.highlight_rules]]
  pattern = '''(?i)⚠|error'''
  color = "red"

  [[agents.highlight_rules]]
  pattern = '''^[❯>].*'''
  color = "cyan"

  [agents.keys]
  approve = "y"
  reject = "n"

  # Support standard prompts: $, #, %, >, ❯
  pattern = '''(?s).*[$#%>❯]\s*\z'''

[[agents]]
id = "pi"
name = "Pi"
background_color = "#eef2ff"
priority = 95
  default_type = "working"

  [[agents.matchers]]
  type = "command"
  pattern = "(?i)^pi$"

  [[agents.matchers]]
  type = "title"
  pattern = "(?i)^π"

  [[agents.state_rules]]
  status = "Approval Required"
  type = "approval"
  # Match explicit "Approval Required" block
  # OR any output ending with ? (ignoring status bar lines starting with ~, /, ↑, or ─)
  pattern = '''(?is)(?:Approval Required|.*\?\s*(?:(?m)^[~/↑─].*\s*)*\z)'''
  last_lines = 40

  [[agents.state_rules]]
  status = "Working..."
  type = "working"
  pattern = '''(?i)[⠋⠙⠹⠸⠼⠴⠦⠧⠇⠏]\s*Working\.\.\.'''

  [[agents.state_rules]]
  status = "idle"
  type = "idle"
  pattern = '''(?s).*❯\s*\z'''

  [[agents.state_rules]]
  status = "idle"
  type = "idle"
  pattern = '''(?m)^↑[\d\.]+[kM]?\s+↓[\d\.]+[kM]?.*'''

[[agents]]
id = "gemini"
name = "Gemini"
background_color = "#fcfce0"
priority = 90
  [[agents.matchers]]
  type = "command"
  pattern = "(?i)gemini|google"

  [[agents.state_rules]]
  status = "Gemini"
  type = "idle"
  pattern = '''(?s).*[>]\s*\z'''

[[agents]]
id = "opencode"
name = "OpenCode"
background_color = "#e6f3ff"
priority = 85
  [[agents.matchers]]
  type = "command"
  pattern = "(?i)opencode|open-code"

  [[agents.state_rules]]
  status = "OpenCode"
  type = "idle"
  pattern = '''(?s).*[>]\s*\z'''

[[agents]]
id = "codex_cli"
name = "Codex"
background_color = "#eaffea"
priority = 80
  [[agents.matchers]]
  type = "command"
  pattern = "(?i)codex|openai"

  [[agents.state_rules]]
  status = "Codex"
  type = "idle"
  pattern = '''(?s).*[>]\s*\z'''

[[agents]]
id = "generic_shell"
name = "shell"
background_color = "#eaffe3"
priority = 10
  # Default for Terminal: if no prompt is seen, it's busy (processing)
  default_type = "working"

  [[agents.matchers]]
  type = "command"
  pattern = ".*"

  # Generic Shell State Rules: TUI Apps (mc, htop, etc.)
  [[agents.state_rules]]
  status = "mc"
  type = "idle"
  last_lines = 3
  pattern = '''(?m)^ 1Help\s+2Menu\s+3View\s+4Edit\s+5Copy\s+6RenMov'''

  [[agents.state_rules]]
  status = "htop"
  type = "idle"
  last_lines = 3
  pattern = '''(?m)^(?:F1| 1)Help\s+F?2Setup\s+F?3Search\s+F?4Filter\s+F?5'''

  [[agents.state_rules]]
  status = "vim"
  type = "idle"
  last_lines = 3
  pattern = '''(?m)^-- (?:INSERT|VISUAL|REPLACE) --|\[[0-9]+\]\s+[0-9]+%\s+L:[0-9]+\s+C:[0-9]+'''

  [[agents.state_rules]]
  status = "tui"
  type = "idle"
  last_lines = 3
  # Detect common frame characters used in TUIs (mc, dialog, etc.)
  pattern = '''[│┌┐└┘├┤┬┴┼═║╔╗╚╝╠╣╦╩╬]'''

  # Error State: Non-zero exit code in prompt (e.g. "1 x")
  [[agents.state_rules]]
  status = "Err"
  type = "error"
  last_lines = 300
  pattern = '''(?s).*\d+\s+x\s*\z'''

  # Generic Shell State Rules: ONLY the prompt makes it Idle
  [[agents.state_rules]]
  status = "shell"
  type = "idle"
  last_lines = 300
  # Support standard prompts: $, #, %, >, ❯
  pattern = '''(?s).*[$#%>❯]\s*\z'''

[prompts]
  [[prompts.items]]
  name = "commit"
  text = "commit"

  [[prompts.items]]
  name = "continue"
  text = "continue"

  [[prompts.items]]
  name = "use internal tools!"
  text = "use internal tools!"

[pane_tree]
mode = "full"
header_template = " ▼ {session}"
compact_template = "  {selection}{window_id}:{window_name} │ {status_char} {name} {status_text}"
full_template = '''  {selection}{status_char} {name}
    {status_text} | pid:{pid} | {uptime}
    {path} {context}
{subagents}'''

[key_bindings]
"j" = { navigate = "next_agent" }
"k" = { navigate = "prev_agent" }
"c" = "toggle_pane_tree_mode"
"y" = "approve"
"Y" = "approve"
"n" = "reject"
"N" = "reject"
"a" = "approve_all"
"A" = "approve_all"
"E" = { send_keys = "Escape" }
"C" = { send_keys = "C-c" }
"D" = { send_keys = "C-d" }
"K" = { kill_app = { method = "sigterm" } }
"r" = "rename_session"
"C-l" = "refresh"
"C-s" = "capture_test_case"
"0" = { send_number = 0 }
"1" = { send_number = 1 }
"2" = { send_number = 2 }
"3" = { send_number = 3 }
"4" = { send_number = 4 }
"5" = { send_number = 5 }
"6" = { send_number = 6 }
"7" = { send_number = 7 }
"8" = { send_number = 8 }
"9" = { send_number = 9 }
"m" = "toggle_menu"
"p" = "toggle_prompts"
"s" = "toggle_filter_selected"
"x" = "toggle_filter_active"
"S" = "toggle_subagent_log"
